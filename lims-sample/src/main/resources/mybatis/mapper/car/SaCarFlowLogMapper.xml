<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.adc.da.car.dao.SaCarFlowLogDAO">
    <resultMap id="BaseResultMap" type="com.adc.da.car.entity.SaCarFlowLogEO">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="ID" property="id"/>
        <result column="DEL_FLAG" property="delFlag"/>
        <result column="CREATE_TIME" property="createTime"/>
        <result column="CREATE_BY" property="createBy"/>
        <result column="CAR_DATA_ID" property="carDataId"/>
        <result column="LEADER_ID" property="leaderId"/>
        <result column="OPERATION_DATE" property="operationDate"/>
        <result column="OPERATION_CONTENT" property="operationContent"/>
        <result column="OPERATOR_ID" property="operatorId"/>
        <result column="TRIAL_APPLY_NO" property="trialApplyNo"/>
        <result column="REMARKS" property="remarks"/>
        <result column="OTHERS" property="others"/>
        <result column="ENTRUST_USER_ID" property="entrustUserId"/>
        <result column="SAMPLE_USER_ID" property="sampleUserId"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        ID, DEL_FLAG, CREATE_TIME, CREATE_BY, CAR_DATA_ID, LEADER_ID, OPERATION_DATE, OPERATION_CONTENT,
        OPERATOR_ID, TRIAL_APPLY_NO, REMARKS, "OTHERS", ENTRUST_USER_ID, SAMPLE_USER_ID
    </sql>

    <insert id="insertSelective" parameterType="com.adc.da.car.entity.SaCarFlowLogEO">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        INSERT INTO SA_CAR_FLOW_LOG
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                ID,
            </if>
            <if test="delFlag != null">
                DEL_FLAG,
            </if>
            <if test="createTime != null">
                CREATE_TIME,
            </if>
            <if test="createBy != null">
                CREATE_BY,
            </if>
            <if test="carDataId != null">
                CAR_DATA_ID,
            </if>
            <if test="leaderId != null">
                LEADER_ID,
            </if>
            <if test="operationDate != null">
                OPERATION_DATE,
            </if>
            <if test="operationContent != null">
                OPERATION_CONTENT,
            </if>
            <if test="operatorId != null">
                OPERATOR_ID,
            </if>
            <if test="trialApplyNo != null">
                TRIAL_APPLY_NO,
            </if>
            <if test="remarks != null">
                REMARKS,
            </if>
            <if test="others != null">
                "OTHERS",
            </if>
            <if test="entrustUserId != null">
                ENTRUST_USER_ID,
            </if>
            <if test="sampleUserId != null">
                SAMPLE_USER_ID,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id},
            </if>
            <if test="delFlag != null">
                #{delFlag},
            </if>
            <if test="createTime != null">
                #{createTime},
            </if>
            <if test="createBy != null">
                #{createBy},
            </if>
            <if test="carDataId != null">
                #{carDataId},
            </if>
            <if test="leaderId != null">
                #{leaderId},
            </if>
            <if test="operationDate != null">
                #{operationDate},
            </if>
            <if test="operationContent != null">
                #{operationContent},
            </if>
            <if test="operatorId != null">
                #{operatorId},
            </if>
            <if test="trialApplyNo != null">
                #{trialApplyNo},
            </if>
            <if test="remarks != null">
                #{remarks},
            </if>
            <if test="others != null">
                #{others},
            </if>
            <if test="entrustUserId != null">
                #{entrustUserId},
            </if>
            <if test="sampleUserId != null">
                #{sampleUserId},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.adc.da.car.entity.SaCarFlowLogEO">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        UPDATE SA_CAR_FLOW_LOG
        <set>
            <if test="delFlag != null">
                DEL_FLAG = #{delFlag},
            </if>
            <if test="createTime != null">
                CREATE_TIME = #{createTime},
            </if>
            <if test="createBy != null">
                CREATE_BY = #{createBy},
            </if>
            <if test="carDataId != null">
                CAR_DATA_ID = #{carDataId},
            </if>
            <if test="leaderId != null">
                LEADER_ID = #{leaderId},
            </if>
            <if test="operationDate != null">
                OPERATION_DATE = #{operationDate},
            </if>
            <if test="operationContent != null">
                OPERATION_CONTENT = #{operationContent},
            </if>
            <if test="operatorId != null">
                OPERATOR_ID = #{operatorId},
            </if>
            <if test="trialApplyNo != null">
                TRIAL_APPLY_NO = #{trialApplyNo},
            </if>
            <if test="remarks != null">
                REMARKS = #{remarks},
            </if>
            <if test="others != null">
                "OTHERS" = #{others},
            </if>
            <if test="sampleUserId != null">
                SAMPLE_USER_ID = #{sampleUserId},
            </if>
            <if test="entrustUserId != null">
                ENTRUST_USER_ID = #{entrustUserId},
            </if>
        </set>
        WHERE ID = #{id}
    </update>

    <update id="deleteByCarId">
        UPDATE SA_CAR_FLOW_LOG
        SET DEL_FLAG = 1
        WHERE CAR_DATA_ID = #{id}
    </update>

    <!-- 列表总数-->
    <select id="queryByCount" resultType="java.lang.Integer" parameterType="com.adc.da.car.page.SaCarFlowLogEOPage">
        SELECT count(1) FROM SA_CAR_FLOW_LOG
        WHERE CAR_DATA_ID = #{carId} AND DEL_FLAG = 0
    </select>

    <!-- 查询列表 -->
    <select id="queryByPage" resultMap="BaseResultMap" parameterType="com.adc.da.car.page.SaCarFlowLogEOPage">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
        (SELECT tmp_tb.* , rownum rn FROM
        (SELECT
        <include refid="Base_Column_List"/>
        FROM SA_CAR_FLOW_LOG
        WHERE CAR_DATA_ID = #{carId} AND DEL_FLAG = 0
        ORDER BY CREATE_TIME DESC
        ) tmp_tb WHERE rownum &lt;= ${pager.endIndex})
        WHERE rn &gt;= ${pager.startIndex}
    </select>

    <select id="selectByCarId" resultType="com.adc.da.car.vo.SaCarFlowLogVO">
        SELECT TU1.USNAME AS leaderName, TU2.USNAME AS operatorName, TO1.ORG_NAME AS leaderOrg, TO2.ORG_NAME AS
            operatorOrg, SCFL.ID, SCFL.REMARKS, SCFL.OPERATION_DATE AS operationDate, SCFL.OTHERS
        FROM SA_CAR_FLOW_LOG SCFL LEFT JOIN TS_USER TU1 ON SCFL.LEADER_ID = TU1.USID
            LEFT JOIN TR_USER_ORG TUO1 ON TU1.USID = TUO1.USER_ID
            LEFT JOIN TS_ORG TO1 ON TO1.ID = TUO1.ORG_ID
            LEFT JOIN TS_USER TU2 ON SCFL.OPERATOR_ID = TU2.USID
            LEFT JOIN TR_USER_ORG TUO2 ON TU2.USID = TUO2.USER_ID
            LEFT JOIN TS_ORG TO2 ON TO2.ID = TUO2.ORG_ID
        WHERE SCFL.DEL_FLAG = 0 AND SCFL.CAR_DATA_ID = #{id} AND SCFL.OPERATION_CONTENT = #{label}
        order by SCFL.CREATE_TIME DESC
    </select>
</mapper>